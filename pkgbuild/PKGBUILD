# Maintainer: Markus Felten <markus.felten@gmx.de>
pkgname=kronos-cluster-node
pkgrel=1
pkgver=r190.6a264a9
epoch=
pkgdesc="kronos cluster node"
arch=('armv7h')
url="http://kronosjs.com/"
license=('BSD')
groups=()
depends=('nodejs')
makedepends=('git')
#checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
#source=(${pkgname}::https://github.com/Kronos-Integration/kronos-cluster-node.git#tag=v${pkgver})
source=(${pkgname}::git+https://github.com/Kronos-Integration/kronos-cluster-node.git)
noextract=()
md5sums=('SKIP')
validpgpkeys=()

pkgver() {
  cd "$pkgname"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
  cd "${pkgname}"
  npm install --production
}

package() {
  cd "${pkgname}"
  install -g kronos -o kronos -d $pkgdir/var/kronos
  install -g kronos -o kronos -d $pkgdir/srv/kronos
  tar cf - bin node_modules package.json|(cd $pkgdir/srv/kronos;tar xf - )
  (cd pkgbuild/support
   mkdir -p etc/systemd/system/multi-user.target.wants
   ln -s usr/lib/systemd/kronos-cluster-node.service etc/systemd/system/multi-user.target.wants/kronos-cluster-node.service
   tar cf - .)|(cd $pkgdir;tar xf - )
}
